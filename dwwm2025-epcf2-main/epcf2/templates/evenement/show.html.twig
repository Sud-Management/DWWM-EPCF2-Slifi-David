{# templates/evenement/show.html.twig #}

<h1>{{ evenement.titre }}</h1>

<p>{{ evenement.description }}</p>

<h2>Participants</h2>

<p>
    Nombre de participants : {{ evenement.participations|length }}
</p>






{% if evenement.participations is empty %}
    <p>Aucun participant pour le moment.</p>
{% else %}
    <ul>
        {% for participation in evenement.participations %}
            <li>
                {{ participation.utilisateur.prenom }} {{ participation.utilisateur.nom }} -
                Statut :
                {% if participation.statut == 'acceptée' %}
                    <span style="color:green;font-weight:bold;">Acceptée</span>
                {% elseif participation.statut == 'refusée' %}
                    <span style="color:red;font-weight:bold;">Refusée</span>
                {% elseif participation.statut == 'en attente' %}
                    <span style="color:orange;font-weight:bold;">En attente</span>
                {% elseif participation.statut == 'annulée' %}
                    <span style="color:gray;">Annulée</span>
                {% else %}
                    {{ participation.statut|capitalize }}
                {% endif %}

                {% if app.user and (app.user == evenement.organisateur or is_granted('ROLE_ADMIN')) and participation.statut == 'en attente' %}
                    <form method="post" action="{{ path('participation_accepter', {id: participation.id}) }}" style="display:inline">
                        <button type="submit">Accepter</button>
                    </form>
                    <form method="post" action="{{ path('participation_refuser', {id: participation.id}) }}" style="display:inline">
                        <button type="submit">Refuser</button>
                    </form>
                {% endif %}

                {% if app.user and app.user == participation.utilisateur and participation.statut != 'annulee' %}
                    <form method="post" action="{{ path('participation_annuler', {id: participation.id}) }}" style="display:inline">
                        <button type="submit">Annuler</button>
                    </form>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endif %}


{% if app.user %}
    {% set userParticipation = null %}
    {% for participation in evenement.participations %}
        {% if participation.utilisateur == app.user %}
            {% set userParticipation = participation %}
        {% endif %}
    {% endfor %}

    {% if userParticipation is null %}
        <form method="post" action="{{ path('participation_demande', {id: evenement.id}) }}">
            <button type="submit">Demander à participer</button>
        </form>
    {% else %}
        <p>Votre participation a bien etait enregistrée : <strong>{{ userParticipation.statut|capitalize }}</strong>.</p>
    {% endif %}
{% else %}
    <p><a href="{{ path('app_login') }}">Connectez-vous</a> pour participer.</p>
{% endif %}

<h2>Médias associés</h2>
{% if evenement.medias is empty %}
    <p>Aucun média pour cet événement.</p>
{% else %}
    <ul>
        {% for media in evenement.medias %}
            <li>
                {% if media.type starts with 'image' %}
                    <img src="{{ asset('uploads/medias/' ~ media.url) }}" alt="media" style="max-width:200px;">
                {% else %}
                    <a href="{{ asset('uploads/medias/' ~ media.url) }}" target="_blank">{{ media.url }}</a>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% endif %}
