{% extends 'base.html.twig' %}

{% block title %}Liste des Événements{% endblock %}

{% block body %}
<h1>Liste des Événements</h1>


<form method="get" class="mb-4 d-flex flex-wrap gap-2 align-items-end">
    <input type="text" name="search" placeholder="Recherche par titre ou description" value="{{ app.request.get('search') }}" class="form-control" style="width: 200px;">
    
    <select name="categorie" class="form-select" style="width: 180px;">
        <option value="">Toutes catégories</option>
        {% for cat in categories %}
            <option value="{{ cat.id }}" {% if app.request.get('categorie') == cat.id %}selected{% endif %}>{{ cat.nom }}</option>
        {% endfor %}
    </select>
    
    <select name="lieu" class="form-select" style="width: 180px;">
        <option value="">Tous lieux</option>
        {% for l in lieux %}
            <option value="{{ l.id }}" {% if app.request.get('lieu') == l.id %}selected{% endif %}>{{ l.nom }}</option>
        {% endfor %}
    </select>
    
    <input type="date" name="date" value="{{ app.request.get('date') }}" class="form-control" style="width: 170px;">
    
    <button type="submit" class="btn btn-primary">Filtrer</button>
    <a href="{{ path('evenement_index') }}" class="btn btn-secondary">Réinitialiser</a>
</form>

{% if is_granted('EVENEMENT_CREATE') %}
    <a href="{{ path('evenement_new') }}" class="btn btn-success mb-3">Créer un événement</a>
{% endif %}

<table class="table table-striped">
    <thead>
        <tr>
            <th>Titre</th>
            <th>Date début</th>
            <th>Date fin</th>
            <th>Lieu</th>
            <th>Organisateur</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for evenement in evenements %}
        <tr>
            <td>{{ evenement.titre }}</td>
            <td>{{ evenement.dateDebut ? evenement.dateDebut|date('d/m/Y H:i') : 'Non défini' }}</td>
            <td>{{ evenement.dateFin ? evenement.dateFin|date('d/m/Y H:i') : 'Non défini' }}</td>
            <td>{{ evenement.lieu ? evenement.lieu.nom : 'Aucun' }}</td>
            <td>{{ evenement.organisateur ? evenement.organisateur.email : 'Inconnu' }}</td>
            <td>
                <a href="{{ path('evenement_show', {'id': evenement.id}) }}" class="btn btn-info btn-sm">Voir</a>

                {% if is_granted('EVENEMENT_EDIT', evenement) %}
                    <a href="{{ path('evenement_edit', {'id': evenement.id}) }}" class="btn btn-warning btn-sm">Modifier</a>
                {% endif %}

                {% if is_granted('EVENEMENT_DELETE', evenement) %}
                    <form method="post" action="{{ path('evenement_delete', {'id': evenement.id}) }}" style="display:inline;" onsubmit="return confirm('Confirmer la suppression ?');">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ evenement.id) }}">
                        <button class="btn btn-danger btn-sm">Supprimer</button>
                    </form>
                {% endif %}
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="6" class="text-center">Aucun événement trouvé</td>
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}